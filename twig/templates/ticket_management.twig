{% extends 'landing.twig' %} {# Using your existing landing.twig as base #}

{% block title %}Ticket Management{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">

  <!-- Header -->
  <header class="relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 to-blue-400 p-8 mb-8">
    <div aria-hidden class="absolute -left-10 -top-10 h-40 w-40 rounded-full bg-red-100 opacity-40 blur-xl"></div>
    <div aria-hidden class="absolute -right-16 top-8 h-28 w-28 rounded-full bg-blue-100 opacity-40 blur-xl"></div>

    <div class="relative z-10 flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
      <div>
        <h1 class="text-3xl font-bold text-white">Ticket Management</h1>
        <p class="mt-2 text-white max-w-xl">
          Create, track and manage tickets. Use this screen to add tickets, edit status, and remove resolved issues.
        </p>
      </div>

      <div class="flex items-center gap-3">
        <button id="btn-show-create" class="inline-flex items-center px-4 py-2 rounded-md bg-white text-blue-600 font-semibold hover:bg-gray-100 transition">
          + New Ticket
        </button>
        <a href="/logout.php" class="inline-flex items-center px-4 py-2 rounded-md border border-white bg-white hover:bg-gray-50 text-gray-800">
          Logout
        </a>
      </div>
    </div>

    <div class="mt-6">
      <svg viewBox="0 0 1440 120" class="w-full h-20" preserveAspectRatio="none">
        <path d="M0,40 C360,120 1080,0 1440,60 L1440 120 L0 120 Z" fill="#ffffff"></path>
      </svg>
    </div>
  </header>

  <!-- Stats -->
  <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6 px-4">
    <div class="p-6 bg-white rounded-2xl shadow-sm">
      <h3 class="text-sm font-medium text-gray-500">Total Tickets</h3>
      <p class="mt-2 text-2xl font-bold text-gray-900">{{ tickets|length }}</p>
    </div>
    <div class="p-6 bg-white rounded-2xl shadow-sm">
      <h3 class="text-sm font-medium text-gray-500">Open Tickets</h3>
      <p class="mt-2 text-2xl font-bold text-yellow-600">
        {{ tickets|filter(t => t.status == 'open')|length }}
      </p>
    </div>
    <div class="p-6 bg-white rounded-2xl shadow-sm">
      <h3 class="text-sm font-medium text-gray-500">Resolved Tickets</h3>
      <p class="mt-2 text-2xl font-bold text-green-600">
        {{ tickets|filter(t => t.status == 'closed')|length }}
      </p>
    </div>
  </section>

  <!-- Ticket List -->
  <section class="px-4">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Tickets</h2>

    {% if tickets is empty %}
      <div class="p-8 bg-white rounded-lg shadow-sm text-center text-gray-600">
        No tickets yet — click “New Ticket” to create one.
      </div>
    {% else %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% for t in tickets %}
          <article class="p-4 bg-white rounded-xl shadow-sm flex flex-col">
            <div class="flex justify-between items-start gap-2">
              <div>
                <h3 class="text-lg font-semibold text-gray-900">{{ t.title }}</h3>
                <p class="text-sm text-gray-500 mt-1">
                  Created: {{ t.createdAt|date("Y-m-d H:i") }}
                </p>
              </div>
              <div class="flex flex-col items-end gap-2">
                {% set status_class = {
                  'open': 'bg-green-50 text-green-700',
                  'in_progress': 'bg-yellow-50 text-yellow-700',
                  'closed': 'bg-gray-100 text-gray-700'
                } %}
                <span class="inline-flex items-center gap-2 px-3 py-1 text-sm rounded-full {{ status_class[t.status] ?? 'bg-gray-100 text-gray-700' }}">
                  {{ t.status|replace({'_':' '}) }}
                </span>
                <div class="flex gap-2">
                  <button class="px-3 py-1 rounded-md border border-gray-200 bg-white text-sm btn-edit" data-id="{{ t.id }}">
                    Edit
                  </button>
                  <button class="px-3 py-1 rounded-md border border-red-200 text-red-600 bg-white hover:bg-red-50 text-sm btn-delete" data-id="{{ t.id }}">
                    Delete
                  </button>
                </div>
              </div>
            </div>

            {% if t.description %}
              <p class="mt-3 text-gray-700">{{ t.description }}</p>
            {% endif %}

            <div class="mt-4 flex items-center justify-between text-sm text-gray-500">
              <div>Priority: {{ t.priority ?? 'medium' }}</div>
              <div>Updated: {{ t.updatedAt ? t.updatedAt|date("Y-m-d H:i") : '-' }}</div>
            </div>
          </article>
        {% endfor %}
      </div>
    {% endif %}
  </section>

  {# ---------- Modals (hidden by default) ---------- #}
  <div id="modal-create" class="fixed inset-0 z-40 hidden items-center justify-center p-4 bg-black/40">
    <div class="w-full max-w-lg bg-white rounded-2xl p-6 shadow-lg">
      <h3 class="text-xl font-semibold">Create Ticket</h3>
      <form action="/tickets/create" method="POST" class="mt-4 grid grid-cols-1 gap-4">
        <label class="text-sm">
          <span class="font-medium">Title</span>
          <input type="text" name="title" class="mt-1 block w-full p-3 border rounded" required>
        </label>

        <label class="text-sm">
          <span class="font-medium">Status</span>
          <select name="status" class="mt-1 block w-full p-3 border rounded">
            <option value="open">open</option>
            <option value="in_progress">in_progress</option>
            <option value="closed">closed</option>
          </select>
        </label>

        <label class="text-sm">
          <span class="font-medium">Priority</span>
          <select name="priority" class="mt-1 block w-full p-3 border rounded">
            <option value="low">low</option>
            <option value="medium" selected>medium</option>
            <option value="high">high</option>
          </select>
        </label>

        <label class="text-sm">
          <span class="font-medium">Description (optional)</span>
          <textarea name="description" rows="4" class="mt-1 block w-full p-3 border rounded"></textarea>
        </label>

        <div class="flex justify-end gap-3 mt-2">
          <button type="button" class="px-4 py-2 rounded-md border bg-white" id="btn-cancel-create">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded-md bg-blue-600 text-white">Create</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Simple modal toggling
    document.getElementById('btn-show-create').addEventListener('click', () => {
      document.getElementById('modal-create').classList.remove('hidden');
      document.getElementById('modal-create').classList.add('flex');
    });
    document.getElementById('btn-cancel-create').addEventListener('click', () => {
      document.getElementById('modal-create').classList.add('hidden');
      document.getElementById('modal-create').classList.remove('flex');
    });
  </script>

</div>
{% endblock %}
